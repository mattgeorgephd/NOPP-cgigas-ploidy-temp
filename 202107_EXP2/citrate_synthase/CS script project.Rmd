---
title: "CS_assay"
output: pdf_document
---
# Make new CS standard curve for new data (3/22/2022)
```{r}
CS<-read_excel("https://github.com/mattgeorgephd/NOPP-gigas-ploidy-temp/blob/main/202107_EXP2/citrate_synthase/Raw%20Data/3.21.22%20Cs%20assay.xls")
#attach labels
#wells<-c(0, 8, 16, 24, 32, 40, "PC_2", "PC_10", "PC_20", "A1", "A1", "A1", "A2", "A2", "A2", "B1", "B1", "B1", "B2", "B2", "B2", "B3", "B3", "B3", "B4", "B4", "B4", "C1", "C1", "C1", "C2", "C2", "C2", "D2", "D2", "D2", "D3", "D3", "D3", "A3", "A3", "A3")
wells<-c(0,0,0, 8, 8, 8, 16, 16, 16, 24, 24, 24, 32, 32, 32, 40, 40, 40, "pos", "pos", "pos", "R41", "R41", "R41", "R41", "R41", "M44", "M44", "M44", "M44", "M44", "R43", "R43", "R43", "R43", "R43", "BACK" , "BACK", "BACK")
CS$Label<-rep(wells, 15)
CS$A<-CS$`Absorbance @ 405 (0.1s) (A)`
#extract standards
cs_standards<-CS[c(1:18),]
#view data
library(ggplot2)
library(dplyr)
library(ggpubr)
#standards
quickview<-ggplot(data=cs_standards)+geom_point(aes(x=Label, y=`NEW A`))+theme_bw()+geom_smooth(aes(x=Label, y=A), method="lm", se=FALSE, formula=y~x^3)+scale_x_discrete(breaks=c(0,8,16,24,32,40))
quickview
#data
samples<-c('M44', 'R43', 'R41')
positive<-subset(CS, Label == samples)
#view data
quickview2<-ggplot(data=positive, aes(x=Repeat, y=A, color=Label))+geom_point()+theme_bw()+geom_smooth(method="lm", se=FALSE, formula=y~x)
quickview2
#get CS results
time_0<-subset(CS, CS$Repeat==1)
time_50<-subset(CS, CS$Repeat==15) #pick maximum data point
initial<-time_0 %>% 
  group_by(Label) %>%
  summarise(meanA = mean(`NEW A`))
final<-time_50 %>% 
  group_by(Label) %>%
  summarise(meanA = mean(`NEW A`))
#Calculate Delta OD
final<-final[c(8, 10,11),] #this will change each time
initial<-initial[c(8, 10, 11),] #this will change each time
deltaOD<-final$meanA-initial$meanA
results<-mutate(initial, OD=deltaOD) #OD is the delta OD for the samples
#Calculate Delta T
t<-55 #min
```

#extract CS content 
```{r}
#CS content
results<-21*time_0$delta-0.73
standard_cs_plot<-ggplot(data=standard_CS,(aes(x=New_A, y=GSH.well)))+geom_point()+geom_smooth(method="lm", se=FALSE, formula = y ~x)+xlab("OD")+ylab("GSH")+theme_bw()+stat_regline_equation(label.x=1, label.y=8)
standard_cs_plot

B<-21*time_0$delta-0.73
V<-50 #uL
D<-1
time<-27 #min
SampleCSactivity<-B/(time*V)*D
time_0$CSactivity<-SampleCSactivity #(nmol/min/uL)
Final_Table<-time_0[-c(2,3,6,8),]
Final_Table<-Final_Table[-c(1:6, 10)]
Final_Table<-cbind(Final_Table, protein_list, tissue_label)
print(Final_Table)
write.csv(Final_Table, file="/Users/oliviacattau/Documents/analysis/CSactivityNov22.csv")
```

# Make new BSA standard curve for new data (12/6/21)
```{r}
bsa<-read.csv(file="https://gannet.fish.washington.edu/gigas/data/BSA_12.6.21_results.csv")
#12.10.21 inspecting data from 12.6.21 test run
library(ggplot2)
library(ggpubr)
standards<-(bsa[c(1:17, 24:40, 47:63),])
A<-standards$Absorbance...570..1.0s...A.
#make plot
standard_plot<-ggplot(data=standards,(aes(x=as.numeric(label), y=A)))+geom_point()+geom_smooth(method="lm", se=FALSE, formula = y ~ poly(x, 1) )+xlab("Concentration of standard ug/mL")+ylab("A @ 570nm")+theme_bw()+stat_regline_equation(label.x=125, label.y=1)

standard_plot

reverse_plot<-ggplot(data=standards,(aes(x=A, y=as.numeric(label))))+geom_point()+geom_smooth(method="lm", se=FALSE, formula = y ~ x )+theme_bw()+stat_regline_equation(label.x=0.6, label.y=500)+ylab("ug/mL")

reverse_plot

#extract equation from plot
protein_content<-2300*A-1300 #with no correction
```

# extract protein content
```{r}
library(tidyr)
library(reshape2)
#clean bsa file
standards<-c(1:3, 49:51, 97:99)
xdata<-(bsa[-standards,])
xdata$A<-xdata$`Absorbance @ 570 (1.0s) (A)`
calc.protein.content<-function(xdata) {
  protein<-2300*xdata$A-1300
  A<-xdata$A
  names<-xdata$label
  return(list(label=names, absorbance=A, protein=protein))
}
final_bsa<-as.data.frame(calc.protein.content(xdata))
final_bsa<-final_bsa[!final_bsa$label=="BUBBLES",]
protein_results_vector<-as.data.frame(tapply(final_bsa$protein, final_bsa$label, mean))
protein_results_vector$protein<-protein_results_vector$`tapply(final_bsa$protein, final_bsa$label, mean)`
protein_results_vector<-protein_results_vector[-c(1)]


weights<-c(28.9,25,17.5,20.5,22.5,18.3,21.1,12.1,17.2,13.6, 18.6, 23.5, 10.1) #mg
length(weights)
volume<-c(300,300,300,300,300,300,300,350,350,350,350,350,350) #uL
concentration<-weights/volume #mg/uL
BSA_total<-cbind(protein_results_vector, volume, weights, concentration)
BSA_total<-subset(BSA_total, protein <= 1000)
write.csv(BSA_total, file="/Users/oliviacattau/Documents/GitHub/NOPP-gigas-ploidy-temp/202107_EXP2/citrate_synthase/BSA_protein_final_12.16.21.csv")
```

