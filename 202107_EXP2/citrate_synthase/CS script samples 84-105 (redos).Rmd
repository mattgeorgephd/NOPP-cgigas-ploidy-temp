---
title: "CS script samples 84-105 (redos)"
author: "Olivia Cattau"
date: '2022-07-14'
output: pdf_document
---

# Samples 83-105 from July 11-12th 2022 (redos from March 22nd)
```{r}
library(ggplot2)
library(dplyr)
library(ggpubr)
#load samples 70-83
CS_6<-read.csv(file="https://raw.githubusercontent.com/mattgeorgephd/NOPP-gigas-ploidy-temp/main/202107_EXP2/citrate_synthase/Raw%20Data/CS%20activity%20july13%20part2.csv")
CS_6['Label'] <- NA
names(CS_6)[7]<-'Label'
names(CS_6)[6]<-'A'
wells<-c(0, 8, 16, 24, 32, 40, "pos","pos", "pos", "background", "background", "background", "X47", "X47", "X47", NA, "T61", "T61", NA, "X42", "X42", "N57", NA, "N57", NA, "X48", "X48", NA, "R42", "R42", NA, "X43", "X43", "X44", "X44", "X44", "D55", NA, "D55", NA, "M47", "M47", "N44", "N44", "N44", NA, "D59", "D59", "R51", "R51", "R51", "T56", "T56", "T56", NA, "R60", "R60", "M41", "M41", "M41", "R46", "R46", "R46", "M89",	"M89",	"M89", NA, "T58", "T58", "R48", "R48", "R48", "T62", "T62", "T62") #NAs are where bubbles affected the results 

CS_6$Label<-rep(wells, 15) #note rep=15 

# Make new CS standard curve for new data (7.12.2022)
cs_standards<-CS_6[c(1051:1056),] #set standards and removed outliers
standards<-as.numeric(c(0, 8, 16, 24, 32, 40)) #relabel
cs_standards$Label<-standards
#plot CS standards
standard_plot<-ggplot(data=cs_standards,(aes(x=A, y=Label)))+geom_point()+geom_smooth(method="lm", se=FALSE, formula = y ~ poly(x, 1) )+xlab("Concentration of standard ug/mL")+ylab("A @ 570nm")+theme_bw()+stat_regline_equation(label.x=0.25, label.y=20)
standard_plot
#extract equation from chart
#y=42x-5.7

###View controls
controls<-c(0,'background', 'pos')
controls2<-subset(CS_6, Label == controls)
quickview<-ggplot(data=controls2, aes(x=Repeat, y=A, color=Label))+geom_point()+theme_bw()+geom_smooth(method="lm", se=FALSE, formula=y~x)
quickview #slightly negative values for background, should be accounted for when subtracting final-initial
#based on controls, I would subtract Repeat 15 values from Repeat 1 values without subtracting 0s from data-set

###View Data
samples<-c("X47", "T61", "X42", "N57", "X48", "R42", "X43", "X44", "D55", "M47",  "N44", "D59", "R51", "T56", "R60", "M41","R46",	"M89", "T58", "R48", "T62")
mydata6<-filter(CS_6, CS_6$Label %in% samples)
quickview6<-ggplot(data=mydata6, aes(x=Repeat, y=A, color=(Label)))+geom_point()+theme_bw()+geom_smooth(method="lm", se=FALSE, formula=y~x)+scale_x_continuous(breaks=seq(1, 15, by=1))
quickview6 #looks great!

##########################Get CS results######################
time_i<-subset(CS_6, CS_6$Repeat==1)
time_f<-subset(CS_6, CS_6$Repeat==15) #pick maximum data point
initial<-time_i %>% 
  group_by(Label) %>%
  summarise(meanA = mean(A))
final<-time_f %>% 
  group_by(Label) %>%
  summarise(meanA = mean(A))
#########################Calculate Delta OD#################
final<-final[-c(1:7, 15, 30),] #this will change each time
initial<-initial[-c(1:7, 15, 30),] #this will change each time
deltaOD<-final$meanA-initial$meanA
results<-mutate(initial, OD=deltaOD) #OD is the delta OD for the samples

####get BSA data#####
bsa<-read.csv(file="https://raw.githubusercontent.com/mattgeorgephd/NOPP-gigas-ploidy-temp/main/202107_EXP2/citrate_synthase/Raw%20Data/BSA%20activity%20part%202%20july%2013th.csv")
names(bsa)[6]<-'A'
wells<-c(2000, 2000, 2000, 1500, 1500, 1500, 1000, 1000, 1000, 750, 750, 750, 500, 500, 500, 250, 250, 250, 125, 125, 125, 0, 0, 0, "X47", "X47", "X47", "T61", "T61", "T61", "X42", "X42", "X42", "N57", "N57", "N57", "X48", "X48", "X48", "R42", "R42", "R42", "X43", "X43", "X43", "X44", "X44", "X44", "D55", "D55", "D55", "M47", "M47", "M47", "N44", "N44", "N44", "D59", "D59", "D59", "R51", "R51", "R51", "T56", "T56", "T56", "R60", "R60", "R60", "M41", "M41", "M41", "R46", "R46", "R46", "M89", "M89", "M89", "T58", "T58", "T58", "R48", "R48", "R48", "T62", "T62", "T62")

bsa$Label<-rep(wells, 3)

bsa_standards<-bsa[c(4:24),]
#make plot

reverse_plot<-ggplot(data=bsa_standards,(aes(x=A, y=as.numeric(Label))))+geom_point()+geom_smooth(method="lm", se=FALSE, formula = y ~ x )+theme_bw()+stat_regline_equation(label.x=0.6, label.y=500)+ylab("ug/mL")

reverse_plot
#y=-1800 +2700x
#extract equation from plot
##############################Calculate Results###############################
A<-bsa %>% 
  group_by(Label) %>%
  summarise(meanA = mean(A))

A_samples<-A[-c(1:8),]  #remove standards 
samples_BSA<-filter(A_samples, A_samples$Label %in% samples) #filter out bad data

protein_content<-(2700*samples_BSA$meanA)-1800 #with no correction, #y=-1800 +2700x

sample_list<-read.csv("https://raw.githubusercontent.com/mattgeorgephd/NOPP-gigas-ploidy-temp/main/202107_EXP2/citrate_synthase/Raw%20Data/weights_redos.csv") #this changed from last CS script, make sure this is the correct weight CSV
names(sample_list)[1]<-'Label'
names(sample_list)[3]<-'Weights'
joined<-inner_join(samples_BSA, sample_list, by="Label") #from CS sample list 
weights<-as.numeric(joined$Weights) 
V1<-350 #uL (added 350uL buffer to tube before homogenization) 
standardization<-weights/V1 #mg/uL
P<-(protein_content/standardization)/1000/1000 #ug/ml, ug/uL, mg/uL  also equal to total protein extracted 

BSA_results<-mutate(samples_BSA, protein_content, weights, standardization, P)

######Calculate Final CS Values
#y= 42x - 5.7 (from CS activity plot)
t<-50 #min
m<-42
b<--5.7
GSH<-(m*deltaOD)+b 
V1<-50 #uL from procedure 
D<-1 #dilution coefficient, should be 1 since we did not dilute
CS_activity<-(GSH/(t*V1))*D/P

results<-mutate(initial, OD=deltaOD, GSH=GSH, weights=weights, protein_content=protein_content, standardized=standardization, "Protein (mg/ul)"=P, "CS activity (nmol/(mg*min))"=CS_activity) #OD is the delta OD for the samples

ploidy<-read.csv(file="https://raw.githubusercontent.com/mattgeorgephd/NOPP-gigas-ploidy-temp/main/202107_EXP2/citrate_synthase/Raw%20Data/ploidy.csv")
names(ploidy)[1]<-'Label'

treatment<-read.csv(file="https://raw.githubusercontent.com/mattgeorgephd/NOPP-gigas-ploidy-temp/main/202107_EXP2/citrate_synthase/Raw%20Data/treatments.csv")
trt<-treatment[c(1:72),]
names(trt)[2]<-'Label'

####tabulate final results table
results_joined<-inner_join(results, ploidy , by="Label") #from CS sample list 

results_joined<-inner_join(results_joined, trt, by="Label")

final_plot<-ggplot(data=results_joined,(aes(x=weights, y=results_joined$`CS activity (nmol/(mg*min))`, color=trt)))+geom_point()+theme_bw()+geom_smooth(method="lm", se=FALSE, formula = y ~ x ) + ylab("CS Activity (nmol/(mg*min))")
final_plot
```


